# Зоны мульти-доступности (AZ)
- Расположение в разных ЦОДах в рамках одного региона
- Минимум должно быть 3 зоны
- Имеется достаточная мощность рабочих узлов для восстановления баланса всех рабочих нагрузок в двух AZ во время простоя.

| Criteria                   | Single Multi-AZ Cluster        | Two Separate Clusters         |
|----------------------------|-------------------------------|-------------------------------|
| **Simplicity**             | ✅ High                       | ❌ Low                        |
| **High Availability**      | ✅ Good (with design)         | ✅ Good                       |
| **Operational Overhead**   | ✅ Low                        | ❌ High                       |
| **Cost**                   | ✅ Lower                      | ❌ Higher                     |
| **Fault Isolation**        | ⚠️ Moderate                  | ✅ High                       |
| **Cross-AZ Communication** | ✅ Easy                       | ❌ Complex                    |
| **Recommended for most cases** | ✅ YES                    | ❌ Only special cases         |

## Проблемы
1) Где запускать etcd? Если AZ всего 2 <br>
Например, у нас кластер из 3х реплик etcd. Это значит fault tolerance - 1. Допустим упала AZ, был мастер с двумя репликами etcd. <br>
В таком случае мы теряем quorum (the minimum number of members of an assembly or society that must be present at any of its meetings to make the proceedings of that meeting valid.) <br>
Последствия:
- etcd не доступен для записи как минимум (мне кажется и на чтение), потерян quorum. Его можно чинить руками.
- API Server не может проводить updates - Pods, Deployments - то есть он с scheduler'ом не сможет зашедулить новые реплики etcd. Но поды которые крутятся - они всё ещё крутятся.
- If AZ1 workers are down, their pods die and won’t be rescheduled.
<img width="1376" height="1086" alt="image" src="https://github.com/user-attachments/assets/844f0d0e-d36c-435d-a066-1194eb03fce7" />
2) Как быть со Storage? PV могуть зависнуть в недоступной зоне. В случае блочки, наверное, нужно replicated Storage хотя бы по двум AZ, в идеале 3.
  
Рекомендации: <br>
- 3 AZ в каждом мастер и etcd  <br>
- Для таких случаев и нужно делать бекап etcd

